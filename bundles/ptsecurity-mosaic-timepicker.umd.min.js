!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/cdk/a11y"),require("@angular/cdk/platform"),require("@angular/common"),require("@angular/core"),require("@angular/forms"),require("@angular/cdk/coercion"),require("@ptsecurity/cdk/datetime"),require("@ptsecurity/cdk/keycodes"),require("@ptsecurity/mosaic/form-field"),require("rxjs")):"function"==typeof define&&define.amd?define("@ptsecurity/mosaic/timepicker",["exports","@angular/cdk/a11y","@angular/cdk/platform","@angular/common","@angular/core","@angular/forms","@angular/cdk/coercion","@ptsecurity/cdk/datetime","@ptsecurity/cdk/keycodes","@ptsecurity/mosaic/form-field","rxjs"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).ptsecurity=e.ptsecurity||{},e.ptsecurity.mosaic=e.ptsecurity.mosaic||{},e.ptsecurity.mosaic.timepicker={}),e.ng.cdk.a11y,e.ng.cdk.platform,e.ng.common,e.ng.core,e.ng.forms,e.ng.cdk.coercion,e.datetime,e.keycodes,e.ptsecurity.mosaic["form-field"],e.rxjs)}(this,(function(e,t,i,r,n,o,a,s,u,l,c){"use strict";var d,p={hours:0,minutes:1,seconds:2};p[p.hours]="hours",p[p.minutes]="minutes",p[p.seconds]="seconds";var h={HHmmss:"HH:mm:ss",HHmm:"HH:mm"},m=((d={})[h.HHmmss]="чч:мм:сс",d[h.HHmm]="чч:мм",d),f=h.HHmm,g=/^([0-1][0-9]|2[0-3]):?([0-5][0-9]):?([0-5][0-9])?$/,y=/^([0-1][0-9]|2[0-3]):?([0-5][0-9])?$/,v=/^([0-1][0-9]|2[0-3]):?$/,b=/^([0-1]?[0-9]):([0-5]?[0-9]) ([ap][m]?$)/i,A={provide:o.NG_VALUE_ACCESSOR,useExisting:n.forwardRef((function(){return E})),multi:!0},T={provide:o.NG_VALIDATORS,useExisting:n.forwardRef((function(){return E})),multi:!0},O=0,E=function(){function e(e,t,i){var r=this;if(this.elementRef=e,this.dateAdapter=t,this.renderer=i,this.stateChanges=new c.Subject,this.focused=!1,this.controlType="mc-timepicker",this._format=f,this._min=null,this._max=null,this.incorrectInput=new n.EventEmitter,this.uid="mc-timepicker-"+O++,this.lastValueValid=!1,this.onInput=function(){var e=r.formatUserInput(r.viewValue),t=r.getDateFromTimeString(e);if(r.lastValueValid=!!t,t){var i=r.selectionStart,n=r.selectionEnd;r.setViewValue(r.getTimeStringFromDate(t,r.format)),r.selectionStart=i,r.selectionEnd=n,r.createSelectionOfTimeComponentInInput(i+1),r.value=t,r.onChange(t),r.stateChanges.next()}else r.control.updateValueAndValidity()},this.parseValidator=function(){return r.focused||r.empty||r.lastValueValid?null:{mcTimepickerParse:{text:r.viewValue}}},this.minValidator=function(e){var t=r.getValidDateOrNull(r.dateAdapter.deserialize(e.value));return!r.min||!t||r.compareTime(r.min,t)<=0?null:{mcTimepickerLowerThenMin:{min:r.min,actual:t}}},this.maxValidator=function(e){var t=r.getValidDateOrNull(r.dateAdapter.deserialize(e.value));return!r.max||!t||r.compareTime(r.max,t)>=0?null:{mcTimepickerHigherThenMax:{max:r.max,actual:t}}},this.validatorOnChange=function(){},!this.dateAdapter)throw Error("McTimepicker: No provider found for DateAdapter. You must import one of the existing modules at your application root or provide a custom implementation or use exists ones.");this.validator=o.Validators.compose([this.parseValidator,this.minValidator,this.maxValidator]),this.onChange=c.noop,this.id=this.id,this.placeholder=m[f]}return Object.defineProperty(e.prototype,"disabled",{get:function(){return this._disabled},set:function(e){this._disabled=a.coerceBooleanProperty(e),this.focused&&(this.focused=!1),this.stateChanges.next()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e||this.uid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"required",{get:function(){return this._required},set:function(e){this._required=a.coerceBooleanProperty(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"format",{get:function(){return this._format},set:function(e){this._format=Object.keys(h).map((function(e){return h[e]})).indexOf(e)>-1?e:f,this.placeholder=m[this._format],this.value&&this.updateView()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"min",{get:function(){return this._min},set:function(e){this._min=this.getValidDateOrNull(this.dateAdapter.deserialize(e)),this.validatorOnChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},set:function(e){this._max=this.getValidDateOrNull(this.dateAdapter.deserialize(e)),this.validatorOnChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){var t=this.dateAdapter.deserialize(e);this.lastValueValid=!t||this.dateAdapter.isValid(t),this._value=this.getValidDateOrNull(t),this.updateView()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mcValidationTooltip",{set:function(e){e&&(e.mcMouseEnterDelay=10,e.mcTrigger="manual",e.mcTooltipClass="mc-tooltip_warning",e.initElementRefListeners(),this.incorrectInput.subscribe((function(){e.isTooltipOpen||(e.show(),setTimeout((function(){return e.hide()}),3e3))})))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSelection",{get:function(){return this.selectionStart!==this.selectionEnd},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isFullFormat",{get:function(){return this.format===h.HHmmss},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isShortFormat",{get:function(){return this.format===h.HHmm},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewValue",{get:function(){return this.elementRef.nativeElement.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ngControl",{get:function(){return this.control},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return!this.viewValue&&!this.isBadInput()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionStart",{get:function(){return this.elementRef.nativeElement.selectionStart},set:function(e){this.elementRef.nativeElement.selectionStart=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"selectionEnd",{get:function(){return this.elementRef.nativeElement.selectionEnd},set:function(e){this.elementRef.nativeElement.selectionEnd=e},enumerable:!1,configurable:!0}),e.prototype.ngOnDestroy=function(){this.stateChanges.complete()},e.prototype.getSize=function(){return this.isFullFormat?8:5},e.prototype.focus=function(){this.elementRef.nativeElement.focus()},e.prototype.focusChanged=function(e){e!==this.focused&&(this.focused=e,this.onTouched(),this.stateChanges.next())},e.prototype.onBlur=function(){this.lastValueValid=!!this.getDateFromTimeString(this.viewValue),this.focusChanged(!1),this.control.updateValueAndValidity()},e.prototype.onPaste=function(e){e.preventDefault();var t=this.formatUserPaste(e.clipboardData.getData("text")),i=this.getDateFromTimeString(t);i&&(this.setViewValue(this.getTimeStringFromDate(i,this.format)),this.value=i,this.onChange(i),this.stateChanges.next())},e.prototype.onContainerClick=function(){this.focus()},e.prototype.onKeyDown=function(e){var t=e.keyCode;if(!u.isLetterKey(e)||e.ctrlKey||e.metaKey)if(u.hasModifierKey(e)&&(u.isVerticalMovement(t)||u.isHorizontalMovement(t))||e.ctrlKey||e.metaKey||[u.DELETE,u.BACKSPACE].includes(t))c.noop();else if(t===u.SPACE)this.spaceKeyHandler(e);else if([u.HOME,u.PAGE_UP].includes(t))this.createSelectionOfTimeComponentInInput(0);else if([u.END,u.PAGE_DOWN].includes(t))this.createSelectionOfTimeComponentInInput(this.viewValue.length);else if([u.UP_ARROW,u.DOWN_ARROW].includes(t))e.preventDefault(),this.verticalArrowKeyHandler(t);else if([u.LEFT_ARROW,u.RIGHT_ARROW].includes(t))this.horizontalArrowKeyHandler(t);else if(/^\D$/.test(e.key)){e.preventDefault();var i=this.getNewValue(e.key,this.selectionStart),r=this.replaceSymbols(i);i!==r?(this.setViewValue(r),setTimeout(this.onInput)):this.incorrectInput.emit()}else setTimeout(this.onInput);else e.preventDefault(),this.incorrectInput.emit()},e.prototype.validate=function(e){return this.setControl(e),this.validator?this.validator(e):null},e.prototype.registerOnValidatorChange=function(e){this.validatorOnChange=e},e.prototype.writeValue=function(e){this.value=e},e.prototype.registerOnChange=function(e){this.onChange=e},e.prototype.registerOnTouched=function(e){this.onTouched=e},e.prototype.setDisabledState=function(e){this.disabled=e},e.prototype.formatUserPaste=function(e){var t;if(e.match(b))return e;var i=e.match(/^(\D+)?(?<hours>\d+)?(\D+)?(\D+)?(?<minutes>\d+)?(\D+)?(\D+)?(?<seconds>\d+)?(\D+)?$/);return(null===(t=null==i?void 0:i.groups)||void 0===t?void 0:t.hours)?this.replaceNumbers(Object.values(i.groups).map((function(e){return(e||"").padStart(2,"0")})).join(":")):(this.setViewValue(e),e)},e.prototype.formatUserInput=function(e){return this.replaceNumbers(this.replaceSymbols(e))},e.prototype.replaceSymbols=function(e){var t=e,i=e.match(/^(\d\d:){0,2}(?<number>[0-9])(?<symbol>\W)(:\d\d){0,2}$/);if(null==i?void 0:i.groups){var r=i.groups,n=r.number,o=r.symbol;t=e.replace(n+o,"0"+n)}return t},e.prototype.replaceNumbers=function(e){var t=e,i=e.match(/^(?<hours>\d{0,4}):?(?<minutes>\d{0,4}):?(?<seconds>\d{0,4})$/);if(null==i?void 0:i.groups){var r=i.groups,n=r.hours,o=r.minutes,a=r.seconds;n.length&&parseInt(n)>23&&(t=t.replace(n,23..toString())),o.length&&parseInt(o)>59&&(t=t.replace(o,59..toString())),a.length&&parseInt(a)>59&&(t=t.replace(a,59..toString()))}return t},e.prototype.isBadInput=function(){var e=this.elementRef.nativeElement.validity;return e&&e.badInput},e.prototype.spaceKeyHandler=function(e){if(e.preventDefault(),this.selectionStart===this.selectionEnd){var t=this.getNewValue(e.key,this.selectionStart),i=this.replaceSymbols(t);t!==i&&(this.setViewValue(i),setTimeout(this.onInput))}else if(this.selectionStart!==this.selectionEnd){var r=this.selectionStart,n=this.viewValue.indexOf(":",r);r=n?n+1:0,this.createSelectionOfTimeComponentInInput(r)}},e.prototype.getNewValue=function(e,t){return[this.viewValue.slice(0,t),e,this.viewValue.slice(t)].join("")},e.prototype.verticalArrowKeyHandler=function(e){if(this.value){var t,i=this.getTimeEditMetrics(this.selectionStart);e===u.UP_ARROW&&(t=this.incrementTime(this.value,i.modifiedTimePart)),e===u.DOWN_ARROW&&(t=this.decrementTime(this.value,i.modifiedTimePart)),this.value=t,this.selectionStart=i.cursorStartPosition,this.selectionEnd=i.cursorEndPosition,this.onChange(t),this.stateChanges.next()}},e.prototype.horizontalArrowKeyHandler=function(e){if(this.value){var t=this.selectionStart;if(e===u.LEFT_ARROW)t=0===t?this.viewValue.length:t-1;else if(e===u.RIGHT_ARROW){var i=this.viewValue.indexOf(":",t);t=i?i+1:0}this.createSelectionOfTimeComponentInInput(t)}},e.prototype.createSelectionOfTimeComponentInInput=function(e){var t=this;setTimeout((function(){var i=t.getTimeEditMetrics(e);t.selectionStart=i.cursorStartPosition,t.selectionEnd=i.cursorEndPosition}))},e.prototype.incrementTime=function(e,t){void 0===t&&(t=p.seconds);var i=this.dateAdapter.getHours(e),r=this.dateAdapter.getMinutes(e),n=this.dateAdapter.getSeconds(e);switch(t){case p.hours:i++;break;case p.minutes:r++;break;case p.seconds:n++}return n>59&&(n=0),r>59&&(r=0),i>23&&(i=0),this.dateAdapter.createDateTime(this.dateAdapter.getYear(this.value),this.dateAdapter.getMonth(this.value),this.dateAdapter.getDate(this.value),i,r,n,this.dateAdapter.getMilliseconds(this.value))},e.prototype.decrementTime=function(e,t){void 0===t&&(t=p.seconds);var i=this.dateAdapter.getHours(e),r=this.dateAdapter.getMinutes(e),n=this.dateAdapter.getSeconds(e);switch(t){case p.hours:i--;break;case p.minutes:r--;break;case p.seconds:n--}return n<0&&(n=59),r<0&&(r=59),i<0&&(i=23),this.dateAdapter.createDateTime(this.dateAdapter.getYear(this.value),this.dateAdapter.getMonth(this.value),this.dateAdapter.getDate(this.value),i,r,n,this.dateAdapter.getMilliseconds(this.value))},e.prototype.getTimeEditMetrics=function(e){var t,i,r,n=this.viewValue,o=n.indexOf(":",1),a=-1!==o?n.indexOf(":",o+1):-1;return-1!==a&&e>a?(t=p.seconds,i=a+1,r=n.length):-1!==o&&e>o?(t=p.minutes,i=o+1,r=a>-1?a:n.length):(t=p.hours,i=0,r=-1!==o?o:n.length),{modifiedTimePart:t,cursorStartPosition:i,cursorEndPosition:r}},e.prototype.getTimeStringFromDate=function(e,t){return e&&this.dateAdapter.isValid(e)?this.dateAdapter.format(e,t):""},e.prototype.getDateFromTimeString=function(e){if(!e)return null;var t=e.match(g),i=e.match(y),r=e.match(v),n=e.match(b),o=0,a=0,s=0;if(n)o=Number(n[1]),a=Number(n[2]),(/[p]/i.test(n[3])||/[a]/i.test(n[3])&&12===o)&&(o+=12);else if(t)o=Number(t[1]),a=Number(t[2]),s=Number(t[3]);else if(i)o=Number(i[1]),a=Number(i[2]);else{if(!r)return null;o=Number(r[1])}var u=this.dateAdapter.createDateTime(this.dateAdapter.getYear(this.value),this.dateAdapter.getMonth(this.value),this.dateAdapter.getDate(this.value),o,a,s,this.dateAdapter.getMilliseconds(this.value));return this.getValidDateOrNull(u)},e.prototype.compareTime=function(e,t){var i=this.dateAdapter.getHours(e)-this.dateAdapter.getHours(t)||this.dateAdapter.getMinutes(e)-this.dateAdapter.getMinutes(t);if(h.HHmm===this.format)return i;if(h.HHmmss===this.format)return i||this.dateAdapter.getSeconds(e)-this.dateAdapter.getSeconds(t);throw Error("Unknown format: "+this.format)},e.prototype.getValidDateOrNull=function(e){return this.dateAdapter.isDateInstance(e)&&this.dateAdapter.isValid(e)?e:null},e.prototype.setViewValue=function(e){this.renderer.setProperty(this.elementRef.nativeElement,"value",e)},e.prototype.updateView=function(){var e=this.getTimeStringFromDate(this.value,this.format);this.setViewValue(e)},e.prototype.setControl=function(e){this.control||(this.control=e)},e}();E.decorators=[{type:n.Directive,args:[{selector:"input[mcTimepicker]",exportAs:"mcTimepicker",host:{class:"mc-input mc-timepicker","[attr.id]":"id","[attr.placeholder]":"placeholder","[attr.disabled]":"disabled || null","[attr.required]":"required","[attr.size]":"getSize()","[attr.autocomplete]":'"off"',"(blur)":"onBlur()","(focus)":"focusChanged(true)","(paste)":"onPaste($event)","(keydown)":"onKeyDown($event)"},providers:[T,A,{provide:l.McFormFieldControl,useExisting:E}]}]}],E.ctorParameters=function(){return[{type:n.ElementRef},{type:s.DateAdapter,decorators:[{type:n.Optional}]},{type:n.Renderer2}]},E.propDecorators={placeholder:[{type:n.Input}],disabled:[{type:n.Input}],id:[{type:n.Input}],required:[{type:n.Input}],format:[{type:n.Input}],min:[{type:n.Input}],max:[{type:n.Input}],value:[{type:n.Input}],mcValidationTooltip:[{type:n.Input}],incorrectInput:[{type:n.Output}]};var V=function(){};V.decorators=[{type:n.NgModule,args:[{imports:[r.CommonModule,t.A11yModule,i.PlatformModule,o.FormsModule],declarations:[E],exports:[E]}]}],e.AM_PM_FORMAT_REGEXP=b,e.DEFAULT_TIME_FORMAT=f,e.HOURS_MINUTES_REGEXP=y,e.HOURS_MINUTES_SECONDS_REGEXP=g,e.HOURS_ONLY_REGEXP=v,e.HOURS_PER_DAY=23,e.MC_TIMEPICKER_VALIDATORS=T,e.MC_TIMEPICKER_VALUE_ACCESSOR=A,e.MINUTES_PER_HOUR=59,e.McTimepicker=E,e.McTimepickerModule=V,e.SECONDS_PER_MINUTE=59,e.TIMEFORMAT_PLACEHOLDERS=m,e.TimeFormats=h,e.TimeParts=p,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ptsecurity-mosaic-timepicker.umd.min.js.map