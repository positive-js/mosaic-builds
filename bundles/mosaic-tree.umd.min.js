/**
 * @license
 * Positive Technologies All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@ptsecurity/cdk/tree"),require("@ptsecurity/cdk/collections"),require("@ptsecurity/mosaic/core"),require("@ptsecurity/cdk/a11y"),require("@ptsecurity/cdk/keycodes"),require("@angular/common"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@ptsecurity/mosaic/tree",["exports","@angular/core","@ptsecurity/cdk/tree","@ptsecurity/cdk/collections","@ptsecurity/mosaic/core","@ptsecurity/cdk/a11y","@ptsecurity/cdk/keycodes","@angular/common","rxjs","rxjs/operators"],t):t((e.ng=e.ng||{},e.ng.mosaic=e.ng.mosaic||{},e.ng.mosaic.tree={}),e.ng.core,e.ng.cdk.tree,e.ng.cdk.collections,e.ng.mosaic.core,e.ng.cdk.a11y,e.ng.cdk.keycodes,e.ng.common,e.rxjs,e.rxjs.operators)}(this,function(e,t,n,i,o,r,a,s,c,d){"use strict";function l(e,t){function n(){this.constructor=e}f(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function u(e,t,n,i){var o,r=arguments.length,a=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(r<3?o(a):r>3?o(t,n,a):o(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a}function p(e,t){return function(n,i){t(n,i,e)}}function h(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}var f=function(e,t){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},g=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}l(i,e),o=i;var o;return u([t.Input("mcTreeNode"),h("design:type",Object)],i.prototype,"data",void 0),i=o=u([t.Directive({selector:"[mcTreeNodeDef]",inputs:["when: mcTreeNodeDefWhen"],providers:[{provide:n.CdkTreeNodeDef,useExisting:o}]})],i)}(n.CdkTreeNodeDef),y=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._baseLeftPadding=6,t._iconWidth=20,t._indent=16,t}l(i,e),o=i,Object.defineProperty(i.prototype,"leftPadding",{get:function(){return(this._withIcon?0:this._iconWidth)+this._baseLeftPadding},enumerable:!0,configurable:!0}),i.prototype._paddingIndent=function(){var e=this._treeNode.data&&this._tree.treeControl.getLevel?this._tree.treeControl.getLevel(this._treeNode.data):null,t=this._level||e;return t?t*this._indent+this.leftPadding+"px":this._baseLeftPadding+"px"},i.prototype.ngOnInit=function(){this._withIcon=this._tree.treeControl.isExpandable(this._treeNode.data),this._setPadding()};var o;return u([t.Input("mcTreeNodePadding"),h("design:type",Number)],i.prototype,"level",void 0),u([t.Input("mcTreeNodePaddingIndent"),h("design:type",Number)],i.prototype,"indent",void 0),i=o=u([t.Directive({selector:"[mcTreeNodePadding]",providers:[{provide:n.CdkTreeNodePadding,useExisting:o}]})],i)}(n.CdkTreeNodePadding),_=function(e){function i(t,n){var i=e.call(this,t,n)||this;return i._elementRef=t,i.treeSelection=n,i.role="treeitem",i._hasFocus=!1,i._disabled=!1,i._selected=!1,i}l(i,e),r=i,Object.defineProperty(i.prototype,"disabled",{get:function(){return this._disabled},set:function(e){var t=o.toBoolean(e);t!==this._disabled&&(this._disabled=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selected",{get:function(){return this.treeSelection.selectedOptions&&this.treeSelection.selectedOptions.isSelected(this)||!1},set:function(e){var t=o.toBoolean(e);t!==this._selected&&this.setSelected(t)},enumerable:!0,configurable:!0}),i.prototype.focus=function(){this._elementRef.nativeElement.focus(),this.treeSelection.setFocusedOption(this)},i.prototype.toggle=function(){this.selected=!this.selected},i.prototype.setSelected=function(e){this._selected!==e&&this.treeSelection.selectedOptions&&(this._selected=e,e?this.treeSelection.selectedOptions.select(this):this.treeSelection.selectedOptions.deselect(this))},i.prototype._getHeight=function(){return this._elementRef.nativeElement.getClientRects()[0].height},i.prototype._handleFocus=function(){this.disabled||this._hasFocus||(this._hasFocus=!0)},i.prototype._handleBlur=function(){this._hasFocus=!1},i.prototype._handleClick=function(){this.disabled||this.treeSelection.setFocusedOption(this)};var r;return u([t.Input(),h("design:type",String)],i.prototype,"role",void 0),u([t.Input(),h("design:type",Object),h("design:paramtypes",[Object])],i.prototype,"disabled",null),u([t.Input(),h("design:type",Boolean),h("design:paramtypes",[Boolean])],i.prototype,"selected",null),i=r=u([t.Directive({exportAs:"mcTreeNodeOption",selector:"mc-tree-node-option",host:{tabindex:"-1","[class.mc-selected]":"selected","[class.mc-focused]":"_hasFocus","[attr.aria-expanded]":"isExpanded","[attr.aria-level]":'role === "treeitem" ? level : null',class:"mc-tree-node","(focus)":"_handleFocus()","(blur)":"_handleBlur()","(click)":"_handleClick()"},providers:[{provide:n.CdkTreeNode,useExisting:r}]}),p(1,t.Inject(t.forwardRef(function(){return k}))),h("design:paramtypes",[t.ElementRef,k])],i)}(n.CdkTreeNode),v=o.mixinTabIndex(o.mixinDisabled(n.CdkTree)),m=function(){function e(e,t){this.source=e,this.option=t}return e}(),b=function(){function e(e,t){this.source=e,this.option=t}return e}(),k=function(e){function s(n,r,a,s,c,d,l){var u=e.call(this,r,a)||this;return u._elementRef=n,u._disabled=!1,u.navigationChange=new t.EventEmitter,u.selectionChange=new t.EventEmitter,u.tabIndex=parseInt(s)||0,u.multiple=null===c||o.toBoolean(c),u.autoSelect=null===d||o.toBoolean(d),u.noUnselect=null===l||o.toBoolean(l),u.selectedOptions=new i.SelectionModel(u.multiple),u}l(s,e),c=s,Object.defineProperty(s.prototype,"disabled",{get:function(){return this._disabled},set:function(e){var t=o.toBoolean(e);this._disabled!==t&&(this._disabled=t,this._disabled?console.log("need disable all options"):console.log("need enable all options"))},enumerable:!0,configurable:!0}),s.prototype._onKeyDown=function(e){var t=e.keyCode;switch(this.withShift=e.shiftKey,this.withCtrl=e.ctrlKey,t){case a.LEFT_ARROW:this._keyManager.activeItem&&this.treeControl.collapse(this._keyManager.activeItem.data),e.preventDefault();break;case a.RIGHT_ARROW:this._keyManager.activeItem&&this.treeControl.expand(this._keyManager.activeItem.data),e.preventDefault();break;case a.SPACE:case a.ENTER:this.toggleFocusedOption(),e.preventDefault();break;case a.HOME:this._keyManager.setFirstItemActive(),e.preventDefault();break;case a.END:this._keyManager.setLastItemActive(),e.preventDefault();break;case a.PAGE_UP:this._keyManager.setPreviousPageItemActive(),e.preventDefault();break;case a.PAGE_DOWN:this._keyManager.setNextPageItemActive(),e.preventDefault();break;default:this._keyManager.onKeydown(e)}},s.prototype.ngAfterContentInit=function(){this._keyManager=new r.FocusKeyManager(this.options).withTypeAhead().withVerticalOrientation(!0).withHorizontalOrientation(null)},s.prototype.updateScrollSize=function(){this.options.first&&this._keyManager.withScrollSize(Math.floor(this._getHeight()/this.options.first._getHeight()))},s.prototype.setFocusedOption=function(e){if(this._keyManager.updateActiveItem(e),this.withShift&&this.multiple){var t=this._keyManager.previousActiveItemIndex,n=this._keyManager.activeItemIndex;t<n?this.options.forEach(function(e,i){i>=t&&i<=n&&e.setSelected(!0)}):this.options.forEach(function(e,i){i>=n&&i<=t&&e.setSelected(!0)}),this.withShift=!1}else if(this.withCtrl){if(this.withCtrl=!1,!this._canDeselectLast(e))return;e.toggle()}else this.autoSelect&&(this.options.forEach(function(e){return e.setSelected(!1)}),e.setSelected(!0));this._emitNavigationEvent(e)},s.prototype.toggleFocusedOption=function(){var e=this._keyManager.activeItemIndex;if(null!=e&&this._isValidIndex(e)){var t=this.options.toArray()[e];t&&this._canDeselectLast(t)&&(t.toggle(),this._emitChangeEvent(t))}},s.prototype.renderNodeChanges=function(t,n,i,o){void 0===n&&(n=this._dataDiffer),void 0===i&&(i=this._nodeOutlet.viewContainer),e.prototype.renderNodeChanges.call(this,t,n,i,o);var r=[];i._embeddedViews.forEach(function(e){var t=e.def;t.nodes.forEach(function(n){if(t.nodeMatchedQueries===n.matchedQueryIds){var i=e.nodes[n.nodeIndex];r.push(i.instance)}})}),this.options&&(this.options.reset(r),this.options.notifyOnChanges()),this.updateScrollSize()},s.prototype._getHeight=function(){return this._elementRef.nativeElement.getClientRects()[0].height},s.prototype._emitNavigationEvent=function(e){this.navigationChange.emit(new m(this,e))},s.prototype._emitChangeEvent=function(e){this.selectionChange.emit(new m(this,e))},s.prototype._isValidIndex=function(e){return e>=0&&e<this.options.length},s.prototype._canDeselectLast=function(e){return!(this.noUnselect&&1===this.selectedOptions.selected.length&&e.selected)};var c;return u([t.ViewChild(n.CdkTreeNodeOutlet),h("design:type",n.CdkTreeNodeOutlet)],s.prototype,"_nodeOutlet",void 0),u([t.ContentChildren(t.forwardRef(function(){return _})),h("design:type",t.QueryList)],s.prototype,"options",void 0),u([t.Input(),h("design:type",Boolean),h("design:paramtypes",[Boolean])],s.prototype,"disabled",null),u([t.Output(),h("design:type",Object)],s.prototype,"navigationChange",void 0),u([t.Output(),h("design:type",Object)],s.prototype,"selectionChange",void 0),s=c=u([t.Component({exportAs:"mcTreeSelection",selector:"mc-tree-selection",template:"<ng-container cdkTreeNodeOutlet></ng-container>",host:{"[tabIndex]":"tabIndex",class:"mc-tree-selection",role:"tree-selection","(keydown)":"_onKeyDown($event)","(window:resize)":"updateScrollSize()"},styles:[".mc-tree-selection{display:block}.mc-tree-node{display:flex;align-items:center;height:28px;word-wrap:break-word;border:2px solid transparent}.mc-tree-node>.mc-icon{margin-right:4px;cursor:pointer}.mc-tree-node:focus{outline:0}.mc-tree-node:not([disabled]){cursor:pointer}.mc-icon-rotate_90{transform:rotate(90deg)}.mc-icon-rotate_180{transform:rotate(180deg)}.mc-icon-rotate_270{transform:rotate(270deg)}"],encapsulation:t.ViewEncapsulation.None,changeDetection:t.ChangeDetectionStrategy.OnPush,providers:[{provide:n.CdkTree,useExisting:c}]}),p(3,t.Attribute("tabindex")),p(4,t.Attribute("multiple")),p(5,t.Attribute("auto-select")),p(6,t.Attribute("no-unselect")),h("design:paramtypes",[t.ElementRef,t.IterableDiffers,t.ChangeDetectorRef,String,String,String,String])],s)}(v),C=[g,y,k,_],x=function(){function e(){}return e=u([t.NgModule({imports:[s.CommonModule,n.CdkTreeModule],exports:C,declarations:C})],e)}(),O=function(){function e(e,t,n,i){this.transformFunction=e,this.getLevel=t,this.isExpandable=n,this.getChildren=i}return e.prototype._flattenNode=function(e,t,n,i){var o=this,r=this.transformFunction(e,t);return n.push(r),this.isExpandable(r)&&this.getChildren(e).pipe(d.take(1)).subscribe(function(e){e.forEach(function(r,a){var s=i.slice();s.push(a!==e.length-1),o._flattenNode(r,t+1,n,s)})}),n},e.prototype.flattenNodes=function(e){var t=this,n=[];return e.forEach(function(e){return t._flattenNode(e,0,n,[])}),n},e.prototype.expandFlattenedNodes=function(e,t){var n=this,i=[],o=[];return o[0]=!0,e.forEach(function(e){for(var r=!0,a=0;a<=n.getLevel(e);a++)r=r&&o[a];r&&i.push(e),n.isExpandable(e)&&(o[n.getLevel(e)+1]=t.isExpanded(e))}),i},e}(),S=function(e){function t(t,n,i){void 0===i&&(i=[]);var o=e.call(this)||this;return o.treeControl=t,o.treeFlattener=n,o._flattenedData=new c.BehaviorSubject([]),o._expandedData=new c.BehaviorSubject([]),o._data=new c.BehaviorSubject(i),o}return l(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data.value},set:function(e){this._data.next(e),this._flattenedData.next(this.treeFlattener.flattenNodes(this.data)),this.treeControl.dataNodes=this._flattenedData.value},enumerable:!0,configurable:!0}),t.prototype.connect=function(e){var t=this,n=[e.viewChange,this.treeControl.expansionModel.onChange,this._flattenedData];return c.merge.apply(void 0,n).pipe(d.map(function(){return t._expandedData.next(t.treeFlattener.expandFlattenedNodes(t._flattenedData.value,t.treeControl)),t._expandedData.value}))},t.prototype.disconnect=function(){},t}(i.DataSource),w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._data=new c.BehaviorSubject([]),t}return l(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data.value},set:function(e){this._data.next(e)},enumerable:!0,configurable:!0}),t.prototype.connect=function(e){var t=this;return c.merge.apply(void 0,[e.viewChange,this._data]).pipe(d.map(function(){return t.data}))},t.prototype.disconnect=function(){},t}(i.DataSource);e.McTreeModule=x,e.McTreeNodeDef=g,e.McTreeNodePadding=y,e.McTreeNodeOption=_,e._McTreeSelectionBase=v,e.McTreeNavigationChange=m,e.McTreeSelectionChange=b,e.McTreeSelection=k,e.McTreeFlattener=O,e.McTreeFlatDataSource=S,e.McTreeNestedDataSource=w,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=mosaic-tree.umd.min.js.map
