/**
 * @license
 * Positive Technologies All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@ptsecurity/cdk/tree"),require("rxjs/operators"),require("@ptsecurity/cdk/a11y"),require("@ptsecurity/mosaic/core"),require("@angular/cdk/coercion"),require("@angular/cdk/collections"),require("@angular/forms"),require("@ptsecurity/cdk/keycodes"),require("rxjs"),require("@angular/common")):"function"==typeof define&&define.amd?define("@ptsecurity/mosaic/tree",["exports","@angular/core","@ptsecurity/cdk/tree","rxjs/operators","@ptsecurity/cdk/a11y","@ptsecurity/mosaic/core","@angular/cdk/coercion","@angular/cdk/collections","@angular/forms","@ptsecurity/cdk/keycodes","rxjs","@angular/common"],t):t((e.ng=e.ng||{},e.ng.mosaic=e.ng.mosaic||{},e.ng.mosaic.tree={}),e.ng.core,e.ng.cdk.tree,e.rxjs.operators,e.ng.cdk.a11y,e.ng.mosaic.core,e.ng.cdk.coercion,e.ng.cdk.collections,e.ng.forms,e.ng.cdk.keycodes,e.rxjs,e.ng.common)}(this,function(e,t,n,o,r,i,s,a,c,l,d,u){"use strict";function p(e,t){function n(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var h=function(e,t){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},f=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return p(o,e),o.decorators=[{type:t.Directive,args:[{selector:"[mcTreeNodeDef]",inputs:["when: mcTreeNodeDefWhen"],providers:[{provide:n.CdkTreeNodeDef,useExisting:o}]}]}],o.propDecorators={data:[{type:t.Input,args:["mcTreeNode"]}]},o}(n.CdkTreeNodeDef),g=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.baseLeftPadding=12,t._indent=20,t.iconWidth=20,t}return p(o,e),Object.defineProperty(o.prototype,"leftPadding",{get:function(){return(this.withIcon?0:this.iconWidth)+this.baseLeftPadding},enumerable:!0,configurable:!0}),o.prototype.paddingIndent=function(){var e=this.treeNode.data&&this.tree.treeControl.getLevel?this.tree.treeControl.getLevel(this.treeNode.data):null,t=this.level||e;return t?t*this._indent+this.leftPadding+"px":this.baseLeftPadding+"px"},o.prototype.ngOnInit=function(){this.withIcon=this.tree.treeControl.isExpandable(this.treeNode.data),this.setPadding()},o.decorators=[{type:t.Directive,args:[{selector:"[mcTreeNodePadding]",providers:[{provide:n.CdkTreeNodePadding,useExisting:o}]}]}],o.propDecorators={level:[{type:t.Input,args:["mcTreeNodePadding"]}],indent:[{type:t.Input,args:["mcTreeNodePaddingIndent"]}]},o}(n.CdkTreeNodePadding),y=function(e){function r(t,n){var r=e.call(this,t,n)||this;return r.disabled=!1,r.tree.treeControl.filterValue.pipe(o.map(function(e){return e.length>0})).subscribe(function(e){return r.disabled=e}),r}return p(r,e),Object.defineProperty(r.prototype,"iconState",{get:function(){return this.disabled||this.tree.treeControl.isExpanded(this.node)},enumerable:!0,configurable:!0}),r.decorators=[{type:t.Component,args:[{selector:"mc-tree-node-toggle",template:'\n        <i class="mc mc-icon mc-angle-down-S_16"></i>\n    ',host:{class:"mc-tree-node-toggle","(click)":"toggle($event)","[class.mc-disabled]":"disabled","[class.mc-opened]":"iconState"},encapsulation:t.ViewEncapsulation.None,providers:[{provide:n.CdkTreeNodeToggle,useExisting:r}]}]}],r.ctorParameters=function(){return[{type:n.CdkTree},{type:n.CdkTreeNode}]},r.propDecorators={node:[{type:t.Input}]},r}(n.CdkTreeNodeToggle),m=function(e){function r(t,n){var r=e.call(this,t,n)||this;return r.disabled=!1,r.tree.treeControl.filterValue.pipe(o.map(function(e){return e.length>0})).subscribe(function(e){return r.disabled=e}),r}return p(r,e),r.decorators=[{type:t.Directive,args:[{selector:"[mcTreeNodeToggle]",host:{"(click)":"toggle($event)","[class.mc-disabled]":"disabled"},providers:[{provide:n.CdkTreeNodeToggle,useExisting:r}]}]}],r.ctorParameters=function(){return[{type:n.CdkTree},{type:n.CdkTreeNode}]},r}(n.CdkTreeNodeToggle),v=new t.InjectionToken("MC_TREE_OPTION_PARENT_COMPONENT"),b=function(){function e(e,t){void 0===t&&(t=!1),this.source=e,this.isUserInput=t}return e}(),C=0,k=function(e){function o(n,o,r,i){var s=e.call(this,n,i)||this;return s.changeDetectorRef=o,s.focusMonitor=r,s.tree=i,s._disabled=!1,s.onSelectionChange=new t.EventEmitter,s._selected=!1,s._id="mc-tree-option-"+C++,s.hasFocus=!1,s}return p(o,e),Object.defineProperty(o.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"disabled",{get:function(){return this._disabled||this.tree&&this.tree.disabled},set:function(e){var t=i.toBoolean(e);t!==this._disabled&&(this._disabled=t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selected",{get:function(){return this._selected},set:function(e){var t=i.toBoolean(e);t!==this._selected&&this.setSelected(t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"multiple",{get:function(){return this.tree.multiple},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"viewValue",{get:function(){return(this.getHostElement().textContent||"").trim()},enumerable:!0,configurable:!0}),o.prototype.ngOnInit=function(){this.focusMonitor.monitor(this.elementRef.nativeElement,!1)},o.prototype.ngAfterContentInit=function(){this.value=this.tree.treeControl.getValue(this.data)},o.prototype.ngOnDestroy=function(){this.focusMonitor.stopMonitoring(this.elementRef.nativeElement)},o.prototype.toggle=function(){this.selected=!this.selected},o.prototype.setSelected=function(e){this._selected!==e&&this.tree.selectionModel&&(this._selected=e,e?this.tree.selectionModel.select(this.value):this.tree.selectionModel.deselect(this.value),this.changeDetectorRef.markForCheck())},o.prototype.handleFocus=function(){this.disabled||this.hasFocus||(this.hasFocus=!0,this.tree.setFocusedOption&&this.tree.setFocusedOption(this))},o.prototype.handleBlur=function(){this.hasFocus=!1},o.prototype.focus=function(){this.focusMonitor.focusVia(this.getHostElement(),"keyboard")},o.prototype.getHeight=function(){var e=this.elementRef.nativeElement.getClientRects();return e.length?e[0].height:0},o.prototype.select=function(){this._selected||(this._selected=!0,this.changeDetectorRef.markForCheck(),this.emitSelectionChangeEvent())},o.prototype.deselect=function(){this._selected&&(this._selected=!1,this.changeDetectorRef.markForCheck())},o.prototype.selectViaInteraction=function(e){this.disabled||(this.changeDetectorRef.markForCheck(),this.emitSelectionChangeEvent(!0),this.tree.setSelectedOption&&this.tree.setSelectedOption(this,e))},o.prototype.emitSelectionChangeEvent=function(e){void 0===e&&(e=!1),this.onSelectionChange.emit(new b(this,e))},o.prototype.getHostElement=function(){return this.elementRef.nativeElement},o.prototype.getTabIndex=function(){return this.disabled?"-1":"0"},o.prototype.markForCheck=function(){this.changeDetectorRef.markForCheck()},o.decorators=[{type:t.Component,args:[{selector:"mc-tree-option",exportAs:"mcTreeOption",template:'<ng-content select="[mc-icon]"></ng-content><mc-pseudo-checkbox *ngIf="multiple" [state]="selected ? \'checked\' : \'\'" [disabled]="disabled"></mc-pseudo-checkbox><span class="mc-option-text"><ng-content></ng-content></span><div class="mc-option-overlay"></div>',host:{"[attr.id]":"id","[attr.tabindex]":"getTabIndex()","[attr.disabled]":"disabled || null",class:"mc-tree-option","[class.mc-selected]":"selected","[class.mc-focused]":"hasFocus","(focus)":"handleFocus()","(blur)":"handleBlur()","(click)":"selectViaInteraction($event)"},changeDetection:t.ChangeDetectionStrategy.OnPush,encapsulation:t.ViewEncapsulation.None,providers:[{provide:n.CdkTreeNode,useExisting:o}]}]}],o.ctorParameters=function(){return[{type:t.ElementRef},{type:t.ChangeDetectorRef},{type:r.FocusMonitor},{type:void 0,decorators:[{type:t.Inject,args:[v]}]}]},o.propDecorators={disabled:[{type:t.Input}],onSelectionChange:[{type:t.Output}]},o}(n.CdkTreeNode),O={provide:c.NG_VALUE_ACCESSOR,useExisting:t.forwardRef(function(){return x}),multi:!0},E=function(){function e(e,t){this.source=e,this.option=t}return e}(),M=function(){function e(e,t){this.source=e,this.option=t}return e}(),x=function(e){function c(n,o,r,i,c){var l=e.call(this,o,r)||this;return l.elementRef=n,l.navigationChange=new t.EventEmitter,l.selectionChange=new t.EventEmitter,l._multiple=!1,l._autoSelect=!0,l._noUnselectLast=!0,l._disabled=!1,l.destroy=new d.Subject,l.onChange=function(){},l.onTouched=function(){},l.tabIndex=parseInt(i)||0,l.multiple=null!==c&&s.coerceBooleanProperty(c),l.multiple&&(l.autoSelect=!1,l.noUnselectLast=!1),l.selectionModel=new a.SelectionModel(l.multiple),l}return p(c,e),Object.defineProperty(c.prototype,"multiple",{get:function(){return this._multiple},set:function(e){this._multiple=s.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"autoSelect",{get:function(){return this._autoSelect},set:function(e){this._autoSelect=s.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"noUnselectLast",{get:function(){return this._noUnselectLast},set:function(e){this._noUnselectLast=s.coerceBooleanProperty(e)},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"disabled",{get:function(){return this._disabled},set:function(e){var t=s.coerceBooleanProperty(e);this._disabled!==t&&(this._disabled=t,this.markOptionsForCheck())},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"tabIndex",{get:function(){return this.disabled?-1:this._tabIndex},set:function(e){this._tabIndex=null!=e?e:0},enumerable:!0,configurable:!0}),c.prototype.ngAfterContentInit=function(){var e=this;this.keyManager=new r.FocusKeyManager(this.renderedOptions).withVerticalOrientation(!0).withHorizontalOrientation(null),this.keyManager.change.pipe(o.takeUntil(this.destroy)).subscribe(function(){e.keyManager.activeItem&&e.emitNavigationEvent(e.keyManager.activeItem)}),this.selectionModel.changed.pipe(o.takeUntil(this.destroy)).subscribe(function(){e.onChange(e.getSelectedValues()),e.renderedOptions.notifyOnChanges()}),this.renderedOptions.changes.pipe(o.takeUntil(this.destroy)).subscribe(function(t){t.forEach(function(t){t.deselect(),e.getSelectedValues().forEach(function(e){t.value===e&&t.select()})})})},c.prototype.ngOnDestroy=function(){this.destroy.next(),this.destroy.complete()},c.prototype.onKeyDown=function(e){switch(e.keyCode){case l.LEFT_ARROW:return this.keyManager.activeItem&&this.treeControl.collapse(this.keyManager.activeItem.data),void e.preventDefault();case l.RIGHT_ARROW:return this.keyManager.activeItem&&this.treeControl.expand(this.keyManager.activeItem.data),void e.preventDefault();case l.SPACE:case l.ENTER:this.toggleFocusedOption(),e.preventDefault();break;case l.HOME:this.keyManager.setFirstItemActive(),e.preventDefault();break;case l.END:this.keyManager.setLastItemActive(),e.preventDefault();break;case l.PAGE_UP:this.keyManager.setPreviousPageItemActive(),e.preventDefault();break;case l.PAGE_DOWN:this.keyManager.setNextPageItemActive(),e.preventDefault();break;default:this.keyManager.onKeydown(e)}this.autoSelect&&this.keyManager.activeItem&&this.setSelectedOption(this.keyManager.activeItem)},c.prototype.updateScrollSize=function(){this.renderedOptions.first&&this.keyManager.withScrollSize(Math.floor(this.getHeight()/this.renderedOptions.first.getHeight()))},c.prototype.setSelectedOption=function(e,t){var n,o=!!t&&l.hasModifierKey(t,"shiftKey"),r=!!t&&l.hasModifierKey(t,"ctrlKey");if(this.multiple)if(o){var i=this.keyManager.previousActiveItemIndex,s=this.keyManager.activeItemIndex;i<s?this.renderedOptions.forEach(function(e,t){t>=i&&t<=s&&e.setSelected(!0)}):this.renderedOptions.forEach(function(e,t){t>=s&&t<=i&&e.setSelected(!0)})}else if(r){if(!this.canDeselectLast(e))return;this.selectionModel.toggle(e.data)}else this.selectionModel.toggle(e.data);else{if(!this.canDeselectLast(e))return;this.autoSelect&&((n=this.selectionModel).deselect.apply(n,this.selectionModel.selected),this.selectionModel.select(e.data))}this.emitChangeEvent(e)},c.prototype.setFocusedOption=function(e){this.keyManager.setActiveItem(e)},c.prototype.toggleFocusedOption=function(){var e=this.keyManager.activeItem;e&&this.setSelectedOption(e)},c.prototype.renderNodeChanges=function(t,n,o,r){void 0===n&&(n=this.dataDiffer),void 0===o&&(o=this.nodeOutlet.viewContainer),e.prototype.renderNodeChanges.call(this,t,n,o,r);var i=[],s=[];o._embeddedViews.forEach(function(e){var t=e.def;t.nodes.forEach(function(n){if(t.nodeMatchedQueries===n.matchedQueryIds){var o=e.nodes[n.nodeIndex];i.push(o.instance),s.push(o.instance.changeDetectorRef)}})}),setTimeout(function(){s.forEach(function(e){e.destroyed||e.detectChanges()})}),this.renderedOptions&&(this.renderedOptions.reset(i),this.renderedOptions.notifyOnChanges()),this.updateScrollSize(),this.nodeOutlet.changeDetectorRef.detectChanges()},c.prototype.getHeight=function(){var e=this.elementRef.nativeElement.getClientRects();return e.length?e[0].height:0},c.prototype.getItemHeight=function(){return this.renderedOptions.first?this.renderedOptions.first.getHeight():0},c.prototype.emitNavigationEvent=function(e){this.navigationChange.emit(new E(this,e))},c.prototype.emitChangeEvent=function(e){this.selectionChange.emit(new E(this,e))},c.prototype.writeValue=function(e){if(this.multiple&&e&&!Array.isArray(e))throw i.getMcSelectNonArrayValueError();this.renderedOptions&&this.setOptionsFromValues(this.multiple?e:[e])},c.prototype.registerOnChange=function(e){this.onChange=e},c.prototype.registerOnTouched=function(e){this.onTouched=e},c.prototype.setDisabledState=function(e){this._disabled=e,this.changeDetectorRef.markForCheck()},c.prototype.setOptionsFromValues=function(e){var t,n=this;this.selectionModel.clear();var o=e.reduce(function(e,t){return n.treeControl.hasValue(t)?e.concat([n.treeControl.hasValue(t)]):e.slice()},[]);(t=this.selectionModel).select.apply(t,o)},c.prototype.getSelectedValues=function(){var e=this;return this.selectionModel.selected.map(function(t){return e.treeControl.getValue(t)})},c.prototype.markOptionsForCheck=function(){this.renderedOptions&&this.renderedOptions.forEach(function(e){return e.markForCheck()})},c.prototype.canDeselectLast=function(e){return!(this.noUnselectLast&&1===this.selectionModel.selected.length&&e.selected)},c.decorators=[{type:t.Component,args:[{selector:"mc-tree-selection",exportAs:"mcTreeSelection",template:"<ng-container cdkTreeNodeOutlet></ng-container>",host:{class:"mc-tree-selection","[tabindex]":"tabIndex","(keydown)":"onKeyDown($event)","(window:resize)":"updateScrollSize()"},styles:[".mc-tree-selection{display:block}.mc-tree-option{display:flex;align-items:center;height:28px;word-wrap:break-word;border:2px solid transparent}.mc-tree-option>.mc-icon{margin-right:4px;cursor:pointer}.mc-tree-option:focus{outline:0}.mc-tree-option:not([disabled]){cursor:pointer}.mc-tree-option .mc-pseudo-checkbox{margin-right:8px}.mc-tree-node-toggle{margin-right:4px}.mc-tree-node-toggle .mc-icon{transform:rotate(-90deg)}.mc-tree-node-toggle.mc-opened .mc-icon{transform:rotate(0)}.mc-tree-node-toggle.mc-disabled{cursor:default}"],encapsulation:t.ViewEncapsulation.None,changeDetection:t.ChangeDetectionStrategy.OnPush,providers:[O,{provide:v,useExisting:c},{provide:n.CdkTree,useExisting:c}]}]}],c.ctorParameters=function(){return[{type:t.ElementRef},{type:t.IterableDiffers},{type:t.ChangeDetectorRef},{type:String,decorators:[{type:t.Attribute,args:["tabindex"]}]},{type:String,decorators:[{type:t.Attribute,args:["multiple"]}]}]},c.propDecorators={nodeOutlet:[{type:t.ViewChild,args:[n.CdkTreeNodeOutlet,{static:!0}]}],renderedOptions:[{type:t.ContentChildren,args:[k]}],treeControl:[{type:t.Input}],navigationChange:[{type:t.Output}],selectionChange:[{type:t.Output}],multiple:[{type:t.Input}],autoSelect:[{type:t.Input}],noUnselectLast:[{type:t.Input}],disabled:[{type:t.Input}]},c}(n.CdkTree),_=[x,k,f,g,y,m],T=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[u.CommonModule,n.CdkTreeModule,i.McPseudoCheckboxModule],exports:_,declarations:_}]}],e}(),D=function(){function e(e,t,n,o){this.transformFunction=e,this.getLevel=t,this.isExpandable=n,this.getChildren=o}return e.prototype.flattenNode=function(e,t,n,r){var i=this,s=this.transformFunction(e,t,r);if(n.push(s),this.isExpandable(s)){var a=this.getChildren(e);a&&(Array.isArray(a)?this.flattenChildren(a,t,n,s):a.pipe(o.take(1)).subscribe(function(e){i.flattenChildren(e,t,n,s)}))}return n},e.prototype.flattenChildren=function(e,t,n,o){var r=this;e.forEach(function(e){r.flattenNode(e,t+1,n,o)})},e.prototype.flattenNodes=function(e){var t=this,n=[];return e.forEach(function(e){return t.flattenNode(e,0,n,null)}),n},e.prototype.expandFlattenedNodes=function(e,t){var n=this,o=[],r=[];return r[0]=!0,e.forEach(function(e){for(var i=!0,s=0;s<=n.getLevel(e);s++)i=i&&r[s];i&&o.push(e),n.isExpandable(e)&&(r[n.getLevel(e)+1]=t.isExpanded(e))}),o},e}(),S={Expansion:"expansion",Filter:"filter"},N=function(e){function t(t,n,o){void 0===o&&(o=[]);var r=e.call(this)||this;return r.treeControl=t,r.treeFlattener=n,r.flattenedData=new d.BehaviorSubject([]),r.expandedData=new d.BehaviorSubject([]),r.filteredData=new d.BehaviorSubject([]),r._data=new d.BehaviorSubject(o),r}return p(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data.value},set:function(e){this._data.next(e),this.flattenedData.next(this.treeFlattener.flattenNodes(this.data)),this.treeControl.dataNodes=this.flattenedData.value},enumerable:!0,configurable:!0}),t.prototype.connect=function(e){var t=this;return d.merge(e.viewChange,this.treeControl.expansionModel.changed.pipe(o.map(function(e){return{type:S.Expansion,value:e}})),this.treeControl.filterValue.pipe(o.map(function(e){return{type:S.Filter,value:e}})),this.flattenedData).pipe(o.map(function(e){return e.type===S.Filter&&e.value&&e.value.length>0?t.filterHandler():t.expansionHandler()}))},t.prototype.filterHandler=function(){return this.filteredData.next(this.treeControl.filterModel.selected),this.filteredData.value},t.prototype.expansionHandler=function(){var e=this.treeFlattener.expandFlattenedNodes(this.flattenedData.value,this.treeControl);return this.expandedData.next(e),this.expandedData.value},t.prototype.disconnect=function(){},t}(a.DataSource),I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._data=new d.BehaviorSubject([]),t}return p(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data.value},set:function(e){this._data.next(e)},enumerable:!0,configurable:!0}),t.prototype.connect=function(e){var t=this;return d.merge.apply(void 0,[e.viewChange,this._data]).pipe(o.map(function(){return t.data}))},t.prototype.disconnect=function(){},t}(a.DataSource);e.McTreeModule=T,e.McTreeNodeDef=f,e.McTreeNodePadding=g,e.McTreeNodeToggleComponent=y,e.McTreeNodeToggleDirective=m,e.MC_SELECTION_TREE_VALUE_ACCESSOR=O,e.McTreeNavigationChange=E,e.McTreeSelectionChange=M,e.McTreeSelection=x,e.MC_TREE_OPTION_PARENT_COMPONENT=v,e.McTreeOptionChange=b,e.McTreeOption=k,e.McTreeFlattener=D,e.McTreeFlatDataSource=N,e.McTreeNestedDataSource=I,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=mosaic-tree.umd.min.js.map
