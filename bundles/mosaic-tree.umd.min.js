/**
 * @license
 * Positive Technologies All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@ptsecurity/cdk/tree"),require("@ptsecurity/mosaic/icon"),require("@ptsecurity/cdk/collections"),require("@ptsecurity/mosaic/core"),require("@ptsecurity/cdk/a11y"),require("@ptsecurity/cdk/keycodes"),require("@angular/common"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define("@ptsecurity/mosaic/tree",["exports","@angular/core","@ptsecurity/cdk/tree","@ptsecurity/mosaic/icon","@ptsecurity/cdk/collections","@ptsecurity/mosaic/core","@ptsecurity/cdk/a11y","@ptsecurity/cdk/keycodes","@angular/common","rxjs","rxjs/operators"],t):t((e.ng=e.ng||{},e.ng.mosaic=e.ng.mosaic||{},e.ng.mosaic.tree={}),e.ng.core,e.ng.cdk.tree,e.ng.mosaic.icon,e.ng.cdk.collections,e.ng.mosaic.core,e.ng.cdk.a11y,e.ng.cdk.keycodes,e.ng.common,e.rxjs,e.rxjs.operators)}(this,function(e,t,n,o,r,i,a,s,c,d,l){"use strict";function u(e,t){function n(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},h=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return u(o,e),o.decorators=[{type:t.Directive,args:[{selector:"[mcTreeNodeDef]",inputs:["when: mcTreeNodeDefWhen"],providers:[{provide:n.CdkTreeNodeDef,useExisting:o}]}]}],o.propDecorators={data:[{type:t.Input,args:["mcTreeNode"]}]},o}(n.CdkTreeNodeDef),f=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._baseLeftPadding=6,t._iconWidth=20,t._indent=16,t}return u(r,e),Object.defineProperty(r.prototype,"leftPadding",{get:function(){return(this._innerIcon?0:this._iconWidth)+this._baseLeftPadding},enumerable:!0,configurable:!0}),r.prototype._paddingIndent=function(){var e=this._treeNode.data&&this._tree.treeControl.getLevel?this._tree.treeControl.getLevel(this._treeNode.data):null,t=this._level||e;return t?t*this._indent+this.leftPadding+"px":this._baseLeftPadding+"px"},r.prototype.ngAfterContentInit=function(){this._setPadding()},r.decorators=[{type:t.Directive,args:[{selector:"[mcTreeNodePadding]",providers:[{provide:n.CdkTreeNodePadding,useExisting:r}]}]}],r.propDecorators={level:[{type:t.Input,args:["mcTreeNodePadding"]}],indent:[{type:t.Input,args:["matTreeNodePaddingIndent"]}],_innerIcon:[{type:t.ContentChild,args:[o.McIcon]}]},r}(n.CdkTreeNodePadding),g=function(e){function o(t,n){var o=e.call(this,t,n)||this;return o._elementRef=t,o.treeSelection=n,o.role="treeitem",o._hasFocus=!1,o._disabled=!1,o._selected=!1,o}return u(o,e),Object.defineProperty(o.prototype,"disabled",{get:function(){return this._disabled},set:function(e){var t=i.toBoolean(e);t!==this._disabled&&(this._disabled=t)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selected",{get:function(){return this.treeSelection.selectedOptions&&this.treeSelection.selectedOptions.isSelected(this)||!1},set:function(e){var t=i.toBoolean(e);t!==this._selected&&this.setSelected(t)},enumerable:!0,configurable:!0}),o.prototype.focus=function(){this._elementRef.nativeElement.focus(),this.treeSelection.setFocusedOption(this)},o.prototype.toggle=function(){this.selected=!this.selected},o.prototype.setSelected=function(e){this._selected!==e&&this.treeSelection.selectedOptions&&(this._selected=e,e?this.treeSelection.selectedOptions.select(this):this.treeSelection.selectedOptions.deselect(this))},o.prototype._handleFocus=function(){this.disabled||this._hasFocus||(this._hasFocus=!0)},o.prototype._handleBlur=function(){this._hasFocus=!1},o.prototype._handleClick=function(){this.disabled||this.treeSelection.setFocusedOption(this)},o.decorators=[{type:t.Directive,args:[{exportAs:"mcTreeNodeOption",selector:"mc-tree-node-option",host:{tabindex:"-1","[class.mc-selected]":"selected","[class.mc-focused]":"_hasFocus","[attr.aria-expanded]":"isExpanded","[attr.aria-level]":'role === "treeitem" ? level : null',class:"mc-tree-node","(focus)":"_handleFocus()","(blur)":"_handleBlur()","(click)":"_handleClick()"},providers:[{provide:n.CdkTreeNode,useExisting:o}]}]}],o.ctorParameters=function(){return[{type:t.ElementRef},{type:m,decorators:[{type:t.Inject,args:[t.forwardRef(function(){return m})]}]}]},o.propDecorators={role:[{type:t.Input}],disabled:[{type:t.Input}],selected:[{type:t.Input}]},o}(n.CdkTreeNode),y=i.mixinTabIndex(i.mixinDisabled(n.CdkTree)),_=function(){function e(e,t){this.source=e,this.option=t}return e}(),v=function(){function e(e,t){this.source=e,this.option=t}return e}(),m=function(e){function o(n,o,a,s,c){var d=e.call(this,n,o)||this;return d._disabled=!1,d.navigationChange=new t.EventEmitter,d.selectionChange=new t.EventEmitter,d.tabIndex=parseInt(a)||0,d.multiple=null===s||i.toBoolean(s),d.autoSelect=null===c||i.toBoolean(c),d.selectedOptions=new r.SelectionModel(d.multiple),d}return u(o,e),Object.defineProperty(o.prototype,"disabled",{get:function(){return this._disabled},set:function(e){var t=i.toBoolean(e);this._disabled!==t&&(this._disabled=t,this._disabled?console.log("need disable all options"):console.log("need enable all options"))},enumerable:!0,configurable:!0}),o.prototype._onKeyDown=function(e){switch(e.keyCode){case s.LEFT_ARROW:this._keyManager.activeItem&&this.treeControl.collapse(this._keyManager.activeItem.data),e.preventDefault();break;case s.RIGHT_ARROW:this._keyManager.activeItem&&this.treeControl.expand(this._keyManager.activeItem.data),e.preventDefault();break;case s.SPACE:case s.ENTER:this.toggleFocusedOption(),e.preventDefault();break;case s.HOME:console.log("need set focus on first node"),e.preventDefault();break;case s.END:console.log("need set focus on last node"),e.preventDefault();break;case s.PAGE_UP:console.log("need do scroll page and set focus on first in viewport"),e.preventDefault();break;case s.PAGE_DOWN:console.log("need do scroll page and set focus on last in viewport"),e.preventDefault();break;default:this._keyManager.onKeydown(e)}},o.prototype.ngAfterContentInit=function(){this._keyManager=new a.FocusKeyManager(this.options).withTypeAhead().withVerticalOrientation(!0).withHorizontalOrientation(null)},o.prototype.setFocusedOption=function(e){this._keyManager.updateActiveItem(e),this.autoSelect&&(this.options.forEach(function(e){return e.setSelected(!1)}),e.setSelected(!0)),this._emitNavigationEvent(e)},o.prototype.toggleFocusedOption=function(){var e=this._keyManager.activeItemIndex;if(null!=e&&this._isValidIndex(e)){var t=this.options.toArray()[e];t&&this._canUnselectLast(t)&&(t.toggle(),this._emitChangeEvent(t))}},o.prototype.renderNodeChanges=function(t,n,o,r){void 0===n&&(n=this._dataDiffer),void 0===o&&(o=this._nodeOutlet.viewContainer),e.prototype.renderNodeChanges.call(this,t,n,o,r);var i=[];o._embeddedViews.forEach(function(e){var t=e.def;t.nodes.forEach(function(n){if(t.nodeMatchedQueries===n.matchedQueryIds){var o=e.nodes[n.nodeIndex];i.push(o.instance)}})}),this.options&&(this.options.reset(i),this.options.notifyOnChanges())},o.prototype._emitNavigationEvent=function(e){this.navigationChange.emit(new _(this,e))},o.prototype._emitChangeEvent=function(e){this.selectionChange.emit(new _(this,e))},o.prototype._isValidIndex=function(e){return e>=0&&e<this.options.length},o.prototype._canUnselectLast=function(e){return!0},o.decorators=[{type:t.Component,args:[{exportAs:"mcTreeSelection",selector:"mc-tree-selection",template:"<ng-container cdkTreeNodeOutlet></ng-container>",host:{"[tabIndex]":"tabIndex",class:"mc-tree",role:"tree-selection","(keydown)":"_onKeyDown($event)"},styles:[".mc-tree{display:block;border:1px solid red}.mc-tree-node{display:flex;align-items:center;height:28px;word-wrap:break-word;border:2px solid transparent}.mc-tree-node>.mc-icon{margin-right:4px;cursor:pointer}.mc-tree-node:focus{outline:0}.mc-tree-node:not([disabled]){cursor:pointer}.mc-icon-rotate_90{transform:rotate(90deg)}.mc-icon-rotate_180{transform:rotate(180deg)}.mc-icon-rotate_270{transform:rotate(270deg)}"],encapsulation:t.ViewEncapsulation.None,changeDetection:t.ChangeDetectionStrategy.OnPush,providers:[{provide:n.CdkTree,useExisting:o}]}]}],o.ctorParameters=function(){return[{type:t.IterableDiffers},{type:t.ChangeDetectorRef},{type:void 0,decorators:[{type:t.Attribute,args:["tabindex"]}]},{type:void 0,decorators:[{type:t.Attribute,args:["multiple"]}]},{type:void 0,decorators:[{type:t.Attribute,args:["auto-select"]}]}]},o.propDecorators={_nodeOutlet:[{type:t.ViewChild,args:[n.CdkTreeNodeOutlet]}],options:[{type:t.ContentChildren,args:[t.forwardRef(function(){return g})]}],disabled:[{type:t.Input}],navigationChange:[{type:t.Output}],selectionChange:[{type:t.Output}]},o}(y),b=[h,f,m,g],x=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[c.CommonModule,n.CdkTreeModule],exports:b,declarations:b}]}],e}(),C=function(){function e(e,t,n,o){this.transformFunction=e,this.getLevel=t,this.isExpandable=n,this.getChildren=o}return e.prototype._flattenNode=function(e,t,n,o){var r=this,i=this.transformFunction(e,t);return n.push(i),this.isExpandable(i)&&this.getChildren(e).pipe(l.take(1)).subscribe(function(e){e.forEach(function(i,a){var s=o.slice();s.push(a!==e.length-1),r._flattenNode(i,t+1,n,s)})}),n},e.prototype.flattenNodes=function(e){var t=this,n=[];return e.forEach(function(e){return t._flattenNode(e,0,n,[])}),n},e.prototype.expandFlattenedNodes=function(e,t){var n=this,o=[],r=[];return r[0]=!0,e.forEach(function(e){for(var i=!0,a=0;a<=n.getLevel(e);a++)i=i&&r[a];i&&o.push(e),n.isExpandable(e)&&(r[n.getLevel(e)+1]=t.isExpanded(e))}),o},e}(),k=function(e){function t(t,n,o){void 0===o&&(o=[]);var r=e.call(this)||this;return r.treeControl=t,r.treeFlattener=n,r._flattenedData=new d.BehaviorSubject([]),r._expandedData=new d.BehaviorSubject([]),r._data=new d.BehaviorSubject(o),r}return u(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data.value},set:function(e){this._data.next(e),this._flattenedData.next(this.treeFlattener.flattenNodes(this.data)),this.treeControl.dataNodes=this._flattenedData.value},enumerable:!0,configurable:!0}),t.prototype.connect=function(e){var t=this,n=[e.viewChange,this.treeControl.expansionModel.onChange,this._flattenedData];return d.merge.apply(void 0,n).pipe(l.map(function(){return t._expandedData.next(t.treeFlattener.expandFlattenedNodes(t._flattenedData.value,t.treeControl)),t._expandedData.value}))},t.prototype.disconnect=function(){},t}(r.DataSource),D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._data=new d.BehaviorSubject([]),t}return u(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data.value},set:function(e){this._data.next(e)},enumerable:!0,configurable:!0}),t.prototype.connect=function(e){var t=this;return d.merge.apply(void 0,[e.viewChange,this._data]).pipe(l.map(function(){return t.data}))},t.prototype.disconnect=function(){},t}(r.DataSource);e.McTreeModule=x,e.McTreeNodeDef=h,e.McTreeNodePadding=f,e.McTreeNodeOption=g,e._McTreeSelectionBase=y,e.McTreeNavigationChange=_,e.McTreeSelectionChange=v,e.McTreeSelection=m,e.McTreeFlattener=C,e.McTreeFlatDataSource=k,e.McTreeNestedDataSource=D,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=mosaic-tree.umd.min.js.map
