/**
 * @license
 * Positive Technologies All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@ptsecurity/cdk/tree"),require("@ptsecurity/mosaic/core"),require("@angular/cdk/collections"),require("@angular/forms"),require("@ptsecurity/cdk/a11y"),require("@ptsecurity/cdk/keycodes"),require("rxjs"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define("@ptsecurity/mosaic/tree",["exports","@angular/core","@ptsecurity/cdk/tree","@ptsecurity/mosaic/core","@angular/cdk/collections","@angular/forms","@ptsecurity/cdk/a11y","@ptsecurity/cdk/keycodes","rxjs","rxjs/operators","@angular/common"],t):t((e.ng=e.ng||{},e.ng.mosaic=e.ng.mosaic||{},e.ng.mosaic.tree={}),e.ng.core,e.ng.cdk.tree,e.ng.mosaic.core,e.ng.cdk.collections,e.ng.forms,e.ng.cdk.a11y,e.ng.cdk.keycodes,e.rxjs,e.rxjs.operators,e.ng.common)}(this,function(e,t,n,o,i,r,a,s,c,l,d){"use strict";function u(e,t){function n(){this.constructor=e}p(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var p=function(e,t){return(p=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},h=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return u(o,e),o.decorators=[{type:t.Directive,args:[{selector:"[mcTreeNodeDef]",inputs:["when: mcTreeNodeDefWhen"],providers:[{provide:n.CdkTreeNodeDef,useExisting:o}]}]}],o.propDecorators={data:[{type:t.Input,args:["mcTreeNode"]}]},o}(n.CdkTreeNodeDef),f=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.baseLeftPadding=12,t._indent=20,t.iconWidth=20,t}return u(o,e),Object.defineProperty(o.prototype,"leftPadding",{get:function(){return(this.withIcon?0:this.iconWidth)+this.baseLeftPadding},enumerable:!0,configurable:!0}),o.prototype.paddingIndent=function(){var e=this.treeNode.data&&this.tree.treeControl.getLevel?this.tree.treeControl.getLevel(this.treeNode.data):null,t=this.level||e;return t?t*this._indent+this.leftPadding+"px":this.baseLeftPadding+"px"},o.prototype.ngOnInit=function(){this.withIcon=this.tree.treeControl.isExpandable(this.treeNode.data),this.setPadding()},o.decorators=[{type:t.Directive,args:[{selector:"[mcTreeNodePadding]",providers:[{provide:n.CdkTreeNodePadding,useExisting:o}]}]}],o.propDecorators={level:[{type:t.Input,args:["mcTreeNodePadding"]}],indent:[{type:t.Input,args:["mcTreeNodePaddingIndent"]}]},o}(n.CdkTreeNodePadding),g=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return u(o,e),o.decorators=[{type:t.Directive,args:[{selector:"[mcTreeNodeToggle]",host:{"(click)":"toggle($event)"},providers:[{provide:n.CdkTreeNodeToggle,useExisting:o}]}]}],o}(n.CdkTreeNodeToggle),y=new t.InjectionToken("MC_TREE_OPTION_PARENT_COMPONENT"),m=function(){function e(e,t){void 0===t&&(t=!1),this.source=e,this.isUserInput=t}return e}(),v=0,b=function(e){function i(n,o,i){var r=e.call(this,n,i)||this;return r.elementRef=n,r.changeDetectorRef=o,r.parent=i,r._disabled=!1,r.onSelectionChange=new t.EventEmitter,r._selected=!1,r._active=!1,r._id="mc-tree-option-"+v++,r}return u(i,e),Object.defineProperty(i.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"disabled",{get:function(){return this._disabled},set:function(e){var t=o.toBoolean(e);t!==this._disabled&&(this._disabled=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"selected",{get:function(){return this._selected},set:function(e){var t=o.toBoolean(e);t!==this._selected&&this.setSelected(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"multiple",{get:function(){return this.parent.multiple},enumerable:!0,configurable:!0}),i.prototype.toggle=function(){this.selected=!this.selected},i.prototype.setSelected=function(e){this._selected!==e&&this.parent.selectionModel&&(this._selected=e,e?this.parent.selectionModel.select(this.value):this.parent.selectionModel.deselect(this.value),this.changeDetectorRef.markForCheck())},i.prototype.setActiveStyles=function(){this._active||(this._active=!0,this.changeDetectorRef.markForCheck())},i.prototype.setInactiveStyles=function(){this._active&&(this._active=!1,this.changeDetectorRef.markForCheck())},i.prototype.getHeight=function(){var e=this.elementRef.nativeElement.getClientRects();return e.length?e[0].height:0},i.prototype.focus=function(){var e=this.getHostElement();"function"==typeof e.focus&&e.focus()},Object.defineProperty(i.prototype,"viewValue",{get:function(){return(this.getHostElement().textContent||"").trim()},enumerable:!0,configurable:!0}),i.prototype.select=function(){this._selected||(this._selected=!0,this.changeDetectorRef.markForCheck())},i.prototype.deselect=function(){this._selected&&(this._selected=!1,this.changeDetectorRef.markForCheck())},i.prototype.selectViaInteraction=function(e){this.disabled||(this.changeDetectorRef.markForCheck(),this.emitSelectionChangeEvent(!0),this.parent.setFocusedOption&&this.parent.setFocusedOption(this,e))},i.prototype.emitSelectionChangeEvent=function(e){void 0===e&&(e=!1),this.onSelectionChange.emit(new m(this,e))},i.prototype.getHostElement=function(){return this.elementRef.nativeElement},i.prototype.getTabIndex=function(){return this.disabled?"-1":"0"},i.decorators=[{type:t.Component,args:[{selector:"mc-tree-option",exportAs:"mcTreeOption",template:'<ng-content select="[mc-icon]"></ng-content><mc-pseudo-checkbox *ngIf="multiple" [state]="selected ? \'checked\' : \'\'" [disabled]="disabled"></mc-pseudo-checkbox><span class="mc-option-text"><ng-content></ng-content></span><div class="mc-option-overlay"></div>',host:{"[attr.id]":"id","[attr.tabindex]":"getTabIndex()","[attr.disabled]":"disabled || null",class:"mc-tree-option","[class.mc-selected]":"selected","[class.mc-active]":"active","(click)":"selectViaInteraction($event)"},changeDetection:t.ChangeDetectionStrategy.OnPush,encapsulation:t.ViewEncapsulation.None,providers:[{provide:n.CdkTreeNode,useExisting:i}]}]}],i.ctorParameters=function(){return[{type:t.ElementRef},{type:t.ChangeDetectorRef},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[y]}]}]},i.propDecorators={value:[{type:t.Input}],disabled:[{type:t.Input}],onSelectionChange:[{type:t.Output}]},i}(n.CdkTreeNode),C=function(){function e(e,t){this.source=e,this.option=t}return e}(),k=function(){function e(e,t){this.source=e,this.option=t}return e}(),_=function(e){function t(t,n){return e.call(this,t,n)||this}return u(t,e),t}(n.CdkTree),E=o.mixinTabIndex(o.mixinDisabled(_)),x=function(e){function d(n,r,a,s,l,d,u,p){var h=e.call(this,r,a)||this;return h.elementRef=n,h.ngControl=s,h.navigationChange=new t.EventEmitter,h.selectionChange=new t.EventEmitter,h._disabled=!1,h.destroy=new c.Subject,h.onChange=function(){},h.onTouched=function(){},h.ngControl&&(h.ngControl.valueAccessor=h),h.tabIndex=parseInt(l)||0,h.multiple=null!==d&&o.toBoolean(d),h.autoSelect=null===u||o.toBoolean(u),h.noUnselectLastSelected=null===p||o.toBoolean(p),h.selectionModel=new i.SelectionModel(h.multiple),h}return u(d,e),Object.defineProperty(d.prototype,"disabled",{get:function(){return this._disabled},set:function(e){var t=o.toBoolean(e);this._disabled!==t&&(this._disabled=t,this._disabled?console.log("need disable all options"):console.log("need enable all options"))},enumerable:!0,configurable:!0}),d.prototype.ngAfterContentInit=function(){var e=this;this.keyManager=new a.ActiveDescendantKeyManager(this.options).withVerticalOrientation(!0).withHorizontalOrientation(null),this.keyManager.change.pipe(l.takeUntil(this.destroy)).subscribe(function(){e.keyManager.activeItem&&e.emitNavigationEvent(e.keyManager.activeItem)}),this.selectionModel.changed.pipe(l.takeUntil(this.destroy)).subscribe(function(t){e.onChange(t.source.selected)}),this.options.changes.pipe(l.takeUntil(this.destroy)).subscribe(function(t){t.forEach(function(t){e.selectionModel.selected.forEach(function(e){t.value===e&&(t._selected=!0)})})})},d.prototype.ngOnDestroy=function(){this.destroy.next(),this.destroy.complete()},d.prototype.onKeyDown=function(e){switch(e.keyCode){case s.LEFT_ARROW:this.keyManager.activeItem&&this.treeControl.collapse(this.keyManager.activeItem.data),e.preventDefault();break;case s.RIGHT_ARROW:this.keyManager.activeItem&&this.treeControl.expand(this.keyManager.activeItem.data),e.preventDefault();break;case s.SPACE:case s.ENTER:this.toggleFocusedOption(),e.preventDefault();break;case s.HOME:this.keyManager.setFirstItemActive(),e.preventDefault();break;case s.END:this.keyManager.setLastItemActive(),e.preventDefault();break;case s.PAGE_UP:this.keyManager.setPreviousPageItemActive(),e.preventDefault();break;case s.PAGE_DOWN:this.keyManager.setNextPageItemActive(),e.preventDefault();break;default:this.keyManager.onKeydown(e)}},d.prototype.updateScrollSize=function(){this.options.first&&this.keyManager.withScrollSize(Math.floor(this.getHeight()/this.options.first.getHeight()))},d.prototype.setFocusedOption=function(e,t){this.keyManager.setActiveItem(e);var n=!!t&&s.hasModifierKey(t,"shiftKey"),o=!!t&&s.hasModifierKey(t,"ctrlKey");if(this.multiple){if(!this.canDeselectLast(e))return;e.toggle(),this.emitChangeEvent(e)}else if(n){var i=this.keyManager.previousActiveItemIndex,r=this.keyManager.activeItemIndex;i<r?this.options.forEach(function(e,t){t>=i&&t<=r&&e.setSelected(!0)}):this.options.forEach(function(e,t){t>=r&&t<=i&&e.setSelected(!0)}),this.emitChangeEvent(e)}else if(o){if(!this.canDeselectLast(e))return;e.toggle(),this.emitChangeEvent(e)}else this.autoSelect&&(this.options.forEach(function(e){return e.setSelected(!1)}),e.setSelected(!0),this.emitChangeEvent(e))},d.prototype.toggleFocusedOption=function(){var e=this.keyManager.activeItem;e&&this.setFocusedOption(e)},d.prototype.renderNodeChanges=function(t,n,o,i){void 0===n&&(n=this.dataDiffer),void 0===o&&(o=this.nodeOutlet.viewContainer),e.prototype.renderNodeChanges.call(this,t,n,o,i);var r=[];o._embeddedViews.forEach(function(e){var t=e.def;t.nodes.forEach(function(n){if(t.nodeMatchedQueries===n.matchedQueryIds){var o=e.nodes[n.nodeIndex];r.push(o.instance),setTimeout(function(){return o.instance.changeDetectorRef.detectChanges()})}})}),this.options&&(this.options.reset(r),this.options.notifyOnChanges()),this.updateScrollSize(),this.nodeOutlet.changeDetectorRef.detectChanges()},d.prototype.getHeight=function(){var e=this.elementRef.nativeElement.getClientRects();return e.length?e[0].height:0},d.prototype.emitNavigationEvent=function(e){this.navigationChange.emit(new C(this,e))},d.prototype.emitChangeEvent=function(e){this.selectionChange.emit(new C(this,e))},d.prototype.writeValue=function(e){this.options&&this.setOptionsFromValues(this.multiple?e:[e])},d.prototype.registerOnChange=function(e){this.onChange=e},d.prototype.registerOnTouched=function(e){this.onTouched=e},d.prototype.setDisabledState=function(e){this._disabled=e,this.changeDetectorRef.markForCheck()},d.prototype.getCorrespondOption=function(e){return this.options.find(function(t){try{return null!=t.value&&t.value===e}catch(e){return console.warn(e),!1}})},d.prototype.setOptionsFromValues=function(e){var t=this;e.forEach(function(e){var n=t.getCorrespondOption(e);t.selectionModel.select(e),n&&(n.selected=!0)})},d.prototype.canDeselectLast=function(e){return!(this.noUnselectLastSelected&&1===this.selectionModel.selected.length&&e.selected)},d.decorators=[{type:t.Component,args:[{selector:"mc-tree-selection",exportAs:"mcTreeSelection",template:"<ng-container cdkTreeNodeOutlet></ng-container>",host:{class:"mc-tree-selection","[attr.tabindex]":"tabIndex","(keydown)":"onKeyDown($event)","(window:resize)":"updateScrollSize()"},styles:[".mc-tree-selection{display:block}.mc-tree-option{display:flex;align-items:center;height:28px;word-wrap:break-word;border:2px solid transparent}.mc-tree-option>.mc-icon{margin-right:4px;cursor:pointer}.mc-tree-option:focus{outline:0}.mc-tree-option:not([disabled]){cursor:pointer}.mc-tree-option .mc-pseudo-checkbox{margin-right:8px}.mc-icon-rotate_90{transform:rotate(90deg)}.mc-icon-rotate_180{transform:rotate(180deg)}.mc-icon-rotate_270{transform:rotate(270deg)}"],encapsulation:t.ViewEncapsulation.None,changeDetection:t.ChangeDetectionStrategy.OnPush,providers:[{provide:y,useExisting:d},{provide:n.CdkTree,useExisting:d}]}]}],d.ctorParameters=function(){return[{type:t.ElementRef},{type:t.IterableDiffers},{type:t.ChangeDetectorRef},{type:r.NgControl,decorators:[{type:t.Self},{type:t.Optional}]},{type:String,decorators:[{type:t.Attribute,args:["tabindex"]}]},{type:String,decorators:[{type:t.Attribute,args:["multiple"]}]},{type:String,decorators:[{type:t.Attribute,args:["auto-select"]}]},{type:String,decorators:[{type:t.Attribute,args:["no-unselect"]}]}]},d.propDecorators={nodeOutlet:[{type:t.ViewChild,args:[n.CdkTreeNodeOutlet,{static:!0}]}],options:[{type:t.ContentChildren,args:[b]}],navigationChange:[{type:t.Output}],selectionChange:[{type:t.Output}],disabled:[{type:t.Input}]},d}(E),D=[x,b,h,f,g],O=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{imports:[d.CommonModule,n.CdkTreeModule,o.McPseudoCheckboxModule],exports:D,declarations:D}]}],e}(),M=function(){function e(e,t,n,o){this.transformFunction=e,this.getLevel=t,this.isExpandable=n,this.getChildren=o}return e.prototype.flattenNode=function(e,t,n,o){var i=this,r=this.transformFunction(e,t);return n.push(r),this.isExpandable(r)&&this.getChildren(e).pipe(l.take(1)).subscribe(function(e){e.forEach(function(r,a){var s=o.slice();s.push(a!==e.length-1),i.flattenNode(r,t+1,n,s)})}),n},e.prototype.flattenNodes=function(e){var t=this,n=[];return e.forEach(function(e){return t.flattenNode(e,0,n,[])}),n},e.prototype.expandFlattenedNodes=function(e,t){var n=this,o=[],i=[];return i[0]=!0,e.forEach(function(e){for(var r=!0,a=0;a<=n.getLevel(e);a++)r=r&&i[a];r&&o.push(e),n.isExpandable(e)&&(i[n.getLevel(e)+1]=t.isExpanded(e))}),o},e}(),T=function(e){function t(t,n,o){void 0===o&&(o=[]);var i=e.call(this)||this;return i.treeControl=t,i.treeFlattener=n,i.flattenedData=new c.BehaviorSubject([]),i.expandedData=new c.BehaviorSubject([]),i._data=new c.BehaviorSubject(o),i}return u(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data.value},set:function(e){this._data.next(e),this.flattenedData.next(this.treeFlattener.flattenNodes(this.data)),this.treeControl.dataNodes=this.flattenedData.value},enumerable:!0,configurable:!0}),t.prototype.connect=function(e){var t=this,n=[e.viewChange,this.treeControl.expansionModel.changed,this.flattenedData];return c.merge.apply(void 0,n).pipe(l.map(function(){return t.expandedData.next(t.treeFlattener.expandFlattenedNodes(t.flattenedData.value,t.treeControl)),t.expandedData.value}))},t.prototype.disconnect=function(){},t}(i.DataSource),N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._data=new c.BehaviorSubject([]),t}return u(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data.value},set:function(e){this._data.next(e)},enumerable:!0,configurable:!0}),t.prototype.connect=function(e){var t=this;return c.merge.apply(void 0,[e.viewChange,this._data]).pipe(l.map(function(){return t.data}))},t.prototype.disconnect=function(){},t}(i.DataSource);e.McTreeModule=O,e.McTreeNodeDef=h,e.McTreeNodePadding=f,e.McTreeNodeToggle=g,e.McTreeNavigationChange=C,e.McTreeSelectionChange=k,e.McTreeSelection=x,e.MC_TREE_OPTION_PARENT_COMPONENT=y,e.McTreeOptionChange=m,e.McTreeOption=b,e.McTreeFlattener=M,e.McTreeFlatDataSource=T,e.McTreeNestedDataSource=N,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=mosaic-tree.umd.min.js.map
