import { InjectionToken } from '@angular/core';
import { RequiredValidator } from '@angular/forms';
export const validationTooltipShowDelay = 10;
export const validationTooltipHideDelay = 3000;
export const MC_VALIDATION = new InjectionToken('McUseValidation', { factory: () => ({ useValidation: true }) });
function setValidState(control, validator) {
    if (!control) {
        return;
    }
    control.clearValidators();
    control.updateValueAndValidity({ emitEvent: false });
    control.setValidators(validator);
}
/** This function do next:
 * - run validation on submitting parent form
 * - prevent validation in required validator if form doesn't submitted
 * - if control has focus validation will be prevented
 */
export function setMosaicValidation(component) {
    const ngControl = component.ngControl;
    if (!ngControl) {
        return;
    }
    const parentForm = component.parentForm || component.parentFormGroup;
    if (parentForm) {
        parentForm.ngSubmit.subscribe(() => {
            // tslint:disable-next-line: no-unnecessary-type-assertion
            ngControl.control.updateValueAndValidity({ emitEvent: false });
        });
    }
    if (component.ngModel) {
        setMosaicValidationForModelControl(component, component.rawValidators, parentForm);
    }
    else if (component.formControlName || component.ngControl) {
        setMosaicValidationForFormControl(component, parentForm, ngControl);
    }
}
export function setMosaicValidationForModelControl(component, validators, parentForm) {
    if (!validators) {
        return;
    }
    validators.forEach((validator) => {
        // tslint:disable-next-line: no-unbound-method
        const originalValidate = validator.validate;
        if (validator instanceof RequiredValidator) {
            // changed required validation logic
            validator.validate = (control) => {
                if (parentForm && !parentForm.submitted) {
                    return null;
                }
                return originalValidate.call(validator, control);
            };
        }
        else {
            // changed all other validation logic
            validator.validate = (control) => {
                if (component.focused) {
                    return null;
                }
                return originalValidate.call(validator, control);
            };
        }
    });
}
export function setMosaicValidationForFormControl(component, parentForm, ngControl) {
    const originalValidator = ngControl.control.validator;
    // changed required validation logic after initialization
    if (ngControl.invalid && ngControl.errors.required) {
        Promise.resolve().then(() => setValidState(ngControl.control, originalValidator));
    }
    // check dynamic updates
    ngControl.statusChanges
        .subscribe(() => {
        // changed required validation logic
        if (ngControl.invalid && (parentForm && !parentForm.submitted) && ngControl.errors.required) {
            setValidState(ngControl.control, originalValidator);
        }
        // changed all other validation logic
        if (ngControl.invalid && component.focused) {
            setValidState(ngControl.control, originalValidator);
        }
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3BhY2thZ2VzL21vc2FpYy9jb3JlL3ZhbGlkYXRpb24vdmFsaWRhdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQy9DLE9BQU8sRUFJSCxpQkFBaUIsRUFJcEIsTUFBTSxnQkFBZ0IsQ0FBQztBQUd4QixNQUFNLENBQUMsTUFBTSwwQkFBMEIsR0FBRyxFQUFFLENBQUM7QUFDN0MsTUFBTSxDQUFDLE1BQU0sMEJBQTBCLEdBQUcsSUFBSSxDQUFDO0FBUS9DLE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBRyxJQUFJLGNBQWMsQ0FDM0MsaUJBQWlCLEVBQ2pCLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsRUFBRSxhQUFhLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUMzQyxDQUFDO0FBR04sU0FBUyxhQUFhLENBQUMsT0FBd0IsRUFBRSxTQUFzQjtJQUNuRSxJQUFJLENBQUMsT0FBTyxFQUFFO1FBQUUsT0FBTztLQUFFO0lBRXpCLE9BQU8sQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUMxQixPQUFPLENBQUMsc0JBQXNCLENBQUMsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztJQUNyRCxPQUFPLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0FBQ3JDLENBQUM7QUFHRDs7OztHQUlHO0FBQ0gsTUFBTSxVQUFVLG1CQUFtQixDQUFDLFNBQVM7SUFDekMsTUFBTSxTQUFTLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQztJQUV0QyxJQUFJLENBQUMsU0FBUyxFQUFFO1FBQUUsT0FBTztLQUFFO0lBRTNCLE1BQU0sVUFBVSxHQUFXLFNBQVMsQ0FBQyxVQUFVLElBQUksU0FBUyxDQUFDLGVBQWUsQ0FBQztJQUU3RSxJQUFJLFVBQVUsRUFBRTtRQUNa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O1xuaW1wb3J0IHtcbiAgICBBYnN0cmFjdENvbnRyb2wsXG4gICAgTmdDb250cm9sLFxuICAgIE5nRm9ybSxcbiAgICBSZXF1aXJlZFZhbGlkYXRvcixcbiAgICBWYWxpZGF0aW9uRXJyb3JzLFxuICAgIFZhbGlkYXRvcixcbiAgICBWYWxpZGF0b3JGblxufSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5cblxuZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25Ub29sdGlwU2hvd0RlbGF5ID0gMTA7XG5leHBvcnQgY29uc3QgdmFsaWRhdGlvblRvb2x0aXBIaWRlRGVsYXkgPSAzMDAwO1xuXG5cbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuYW1pbmctY29udmVudGlvblxuZXhwb3J0IGludGVyZmFjZSBNY1ZhbGlkYXRpb25PcHRpb25zIHtcbiAgICB1c2VWYWxpZGF0aW9uOiBib29sZWFuO1xufVxuXG5leHBvcnQgY29uc3QgTUNfVkFMSURBVElPTiA9IG5ldyBJbmplY3Rpb25Ub2tlbjxNY1ZhbGlkYXRpb25PcHRpb25zPihcbiAgICAnTWNVc2VWYWxpZGF0aW9uJyxcbiAgICB7IGZhY3Rvcnk6ICgpID0+ICh7IHVzZVZhbGlkYXRpb246IHRydWUgfSkgfVxuICAgICk7XG5cblxuZnVuY3Rpb24gc2V0VmFsaWRTdGF0ZShjb250cm9sOiBBYnN0cmFjdENvbnRyb2wsIHZhbGlkYXRvcjogVmFsaWRhdG9yRm4pOiB2b2lkIHtcbiAgICBpZiAoIWNvbnRyb2wpIHsgcmV0dXJuOyB9XG5cbiAgICBjb250cm9sLmNsZWFyVmFsaWRhdG9ycygpO1xuICAgIGNvbnRyb2wudXBkYXRlVmFsdWVBbmRWYWxpZGl0eSh7IGVtaXRFdmVudDogZmFsc2UgfSk7XG4gICAgY29udHJvbC5zZXRWYWxpZGF0b3JzKHZhbGlkYXRvcik7XG59XG5cblxuLyoqIFRoaXMgZnVuY3Rpb24gZG8gbmV4dDpcbiAqIC0gcnVuIHZhbGlkYXRpb24gb24gc3VibWl0dGluZyBwYXJlbnQgZm9ybVxuICogLSBwcmV2ZW50IHZhbGlkYXRpb24gaW4gcmVxdWlyZWQgdmFsaWRhdG9yIGlmIGZvcm0gZG9lc24ndCBzdWJtaXR0ZWRcbiAqIC0gaWYgY29udHJvbCBoYXMgZm9jdXMgdmFsaWRhdGlvbiB3aWxsIGJlIHByZXZlbnRlZFxuICovXG5leHBvcnQgZnVuY3Rpb24gc2V0TW9zYWljVmFsaWRhdGlvbihjb21wb25lbnQpIHtcbiAgICBjb25zdCBuZ0NvbnRyb2wgPSBjb21wb25lbnQubmdDb250cm9sO1xuXG4gICAgaWYgKCFuZ0NvbnRyb2wpIHsgcmV0dXJuOyB9XG5cbiAgICBjb25zdCBwYXJlbnRGb3JtOiBOZ0Zvcm0gPSBjb21wb25lbnQucGFyZW50Rm9ybSB8fCBjb21wb25lbnQucGFyZW50Rm9ybUdyb3VwO1xuXG4gICAgaWYgKHBhcmVudEZvcm0pIHtcbiAgICAgICAgcGFyZW50Rm9ybS5uZ1N1Ym1pdC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby11bm5lY2Vzc2FyeS10eXBlLWFzc2VydGlvblxuICAgICAgICAgICAgbmdDb250cm9sLmNvbnRyb2whLnVwZGF0ZVZhbHVlQW5kVmFsaWRpdHkoeyBlbWl0RXZlbnQ6IGZhbHNlIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoY29tcG9uZW50Lm5nTW9kZWwpIHtcbiAgICAgICAgc2V0TW9zYWljVmFsaWRhdGlvbkZvck1vZGVsQ29udHJvbChjb21wb25lbnQsIGNvbXBvbmVudC5yYXdWYWxpZGF0b3JzLCBwYXJlbnRGb3JtKTtcbiAgICB9IGVsc2UgaWYgKGNvbXBvbmVudC5mb3JtQ29udHJvbE5hbWUgfHwgY29tcG9uZW50Lm5nQ29udHJvbCkge1xuICAgICAgICBzZXRNb3NhaWNWYWxpZGF0aW9uRm9yRm9ybUNvbnRyb2woY29tcG9uZW50LCBwYXJlbnRGb3JtLCBuZ0NvbnRyb2wpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBzZXRNb3NhaWNWYWxpZGF0aW9uRm9yTW9kZWxDb250cm9sKGNvbXBvbmVudCwgdmFsaWRhdG9yczogVmFsaWRhdG9yW10sIHBhcmVudEZvcm06IE5nRm9ybSkge1xuICAgIGlmICghdmFsaWRhdG9ycykgeyByZXR1cm47IH1cblxuICAgIHZhbGlkYXRvcnMuZm9yRWFjaCgodmFsaWRhdG9yOiBWYWxpZGF0b3IpID0+IHtcbiAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBuby11bmJvdW5kLW1ldGhvZFxuICAgICAgICBjb25zdCBvcmlnaW5hbFZhbGlkYXRlID0gdmFsaWRhdG9yLnZhbGlkYXRlO1xuXG4gICAgICAgIGlmICh2YWxpZGF0b3IgaW5zdGFuY2VvZiBSZXF1aXJlZFZhbGlkYXRvcikge1xuICAgICAgICAgICAgLy8gY2hhbmdlZCByZXF1aXJlZCB2YWxpZGF0aW9uIGxvZ2ljXG4gICAgICAgICAgICB2YWxpZGF0b3IudmFsaWRhdGUgPSAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGwgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChwYXJlbnRGb3JtICYmICFwYXJlbnRGb3JtLnN1Ym1pdHRlZCkgeyByZXR1cm4gbnVsbDsgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsVmFsaWRhdGUuY2FsbCh2YWxpZGF0b3IsIGNvbnRyb2wpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGNoYW5nZWQgYWxsIG90aGVyIHZhbGlkYXRpb24gbG9naWNcbiAgICAgICAgICAgIHZhbGlkYXRvci52YWxpZGF0ZSA9IChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzIHwgbnVsbCA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5mb2N1c2VkKSB7IHJldHVybiBudWxsOyB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxWYWxpZGF0ZS5jYWxsKHZhbGlkYXRvciwgY29udHJvbCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRNb3NhaWNWYWxpZGF0aW9uRm9yRm9ybUNvbnRyb2woY29tcG9uZW50LCBwYXJlbnRGb3JtOiBOZ0Zvcm0sIG5nQ29udHJvbDogTmdDb250cm9sKSB7XG4gICAgY29uc3Qgb3JpZ2luYWxWYWxpZGF0b3IgPSBuZ0NvbnRyb2wuY29udHJvbCEudmFsaWRhdG9yO1xuXG4gICAgLy8gY2hhbmdlZCByZXF1aXJlZCB2YWxpZGF0aW9uIGxvZ2ljIGFmdGVyIGluaXRpYWxpemF0aW9uXG4gICAgaWYgKG5nQ29udHJvbC5pbnZhbGlkICYmIG5nQ29udHJvbC5lcnJvcnMhLnJlcXVpcmVkKSB7XG4gICAgICAgIFByb21pc2UucmVzb2x2ZSgpLnRoZW4oKCkgPT4gc2V0VmFsaWRTdGF0ZShuZ0NvbnRyb2wuY29udHJvbCEsIG9yaWdpbmFsVmFsaWRhdG9yISkpO1xuICAgIH1cblxuICAgIC8vIGNoZWNrIGR5bmFtaWMgdXBkYXRlc1xuICAgIG5nQ29udHJvbC5zdGF0dXNDaGFuZ2VzIVxuICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIC8vIGNoYW5nZWQgcmVxdWlyZWQgdmFsaWRhdGlvbiBsb2dpY1xuICAgICAgICAgICAgaWYgKG5nQ29udHJvbC5pbnZhbGlkICYmIChwYXJlbnRGb3JtICYmICFwYXJlbnRGb3JtLnN1Ym1pdHRlZCkgJiYgbmdDb250cm9sLmVycm9ycyEucmVxdWlyZWQpIHtcbiAgICAgICAgICAgICAgICBzZXRWYWxpZFN0YXRlKG5nQ29udHJvbC5jb250cm9sISwgb3JpZ2luYWxWYWxpZGF0b3IhKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gY2hhbmdlZCBhbGwgb3RoZXIgdmFsaWRhdGlvbiBsb2dpY1xuICAgICAgICAgICAgaWYgKG5nQ29udHJvbC5pbnZhbGlkICYmIGNvbXBvbmVudC5mb2N1c2VkKSB7XG4gICAgICAgICAgICAgICAgc2V0VmFsaWRTdGF0ZShuZ0NvbnRyb2wuY29udHJvbCEsIG9yaWdpbmFsVmFsaWRhdG9yISk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xufVxuIl19